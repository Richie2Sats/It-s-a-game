<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üî• Live RPS Battle</title>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body { font-family: 'Arial Black', Arial; text-align: center; background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c); background-size: 400% 400%; animation: gradientShift 15s ease infinite; color: white; margin: 0; padding: 20px; min-height: 100vh; }
    @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
    h1 { text-shadow: 0 0 20px rgba(255,255,255,0.8); animation: glow 2s infinite alternate; }
    @keyframes glow { from { text-shadow: 0 0 10px white; } to { text-shadow: 0 0 30px gold; } }
    input, button { padding: 15px; margin: 10px; font-size: 18px; border: none; border-radius: 15px; width: 90%; max-width: 320px; box-shadow: 0 6px 20px rgba(0,0,0,0.4); transition: all 0.3s; }
    button { background: linear-gradient(45deg, #ff6b6b, #ee5a52); color: white; cursor: pointer; font-weight: bold; }
    button:hover { transform: scale(1.05) translateY(-5px); box-shadow: 0 15px 30px rgba(255,107,107,0.6); }
    #status { font-size: 26px; margin: 20px; text-shadow: 0 2px 10px black; }
    #choices { display: none; }
    .rps-btn { width: 28%; background: linear-gradient(45deg, #4ecdc4, #44a08d); margin: 8px; font-size: 36px; border-radius: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.5); transition: all 0.2s; }
    .rps-btn:hover { transform: scale(1.15) rotate(8deg); box-shadow: 0 15px 40px rgba(78,205,196,0.8); }
    .rps-btn:active { animation: shake 0.5s; }
    @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
    .score { font-size: 34px; margin: 15px; font-weight: bold; animation: scorePop 0.6s; }
    @keyframes scorePop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
    .winner { animation: flash 0.5s infinite, bounce 0.8s infinite; font-size: 32px; color: gold !important; text-shadow: 0 0 30px gold; }
    @keyframes flash { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
    @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
    #confetti-canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }
    #victory { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.9); padding: 50px; border-radius: 30px; font-size: 48px; color: gold; z-index: 1000; animation: victoryPulse 1s infinite; box-shadow: 0 0 50px gold; }
    @keyframes victoryPulse { 0% { transform: translate(-50%, -50%) scale(1); } 50% { transform: translate(-50%, -50%) scale(1.1); } 100% { transform: translate(-50%, -50%) scale(1); } }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <div id="victory">üèÜ YOU WIN THE MATCH! üèÜ<br><button onclick="location.reload()" style="margin-top:30px;padding:15px 30px;font-size:24px;">Play Again</button></div>
  <h1>üî• Live Rock Paper Scissors Battle</h1>
  <p>Share room code with a friend!</p>
  <input id="room" placeholder="Room code (e.g., battle123)">
  <button onclick="joinRoom()">Join / Create Room</button>
  <div id="status">Waiting to connect...</div>
  <div id="scores"></div>
  <div id="choices">
    <button class="rps-btn" onclick="pick('rock')">ü™®</button>
    <button class="rps-btn" onclick="pick('paper')">üìÑ</button>
    <button class="rps-btn" onclick="pick('scissors')">‚úÇÔ∏è</button>
  </div>
  <div id="result"></div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDxwj4gjfwCGjgsWCpEHDyB8B03cpGs",
      authDomain: "it-s-a-game-c564d.firebaseapp.com",
      databaseURL: "https://it-s-a-game-c564d-default-rtdb.firebaseio.com/",
      projectId: "it-s-a-game-c564d",
      storageBucket: "it-s-a-game-c564d.appspot.com",
      messagingSenderId: "833723070612",
      appId: "1:833723070612:web:b09c51fc80fa964b9c81",
      measurementId: "G-R21LB7V3KH"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let gameRef, playerNum = null, roomId = null;
    const choices = { rock: 0, paper: 1, scissors: 2 };
    const beats = { 0: 2, 1: 0, 2: 1 };
    const winTarget = 5;

    function playSound(freq, duration) {
      const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioCtx.createOscillator();
      const gainNode = audioCtx.createGain();
      oscillator.connect(gainNode);
      gainNode.connect(audioCtx.destination);
      oscillator.frequency.value = freq;
      oscillator.type = 'square';
      gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
      gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
      oscillator.start(audioCtx.currentTime);
      oscillator.stop(audioCtx.currentTime + duration);
    }

    function confettiBurst() {
      confetti({
        particleCount: 200,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#ff6b6b', '#f5576c', '#f093fb', '#667eea', '#764ba2']
      });
    }

    function joinRoom() {
      roomId = document.getElementById('room').value.trim().toLowerCase();
      if (!roomId) return alert('Enter a room code!');
      gameRef = db.ref('games/' + roomId);
      document.getElementById('status').textContent = 'Joining room...';
      playSound(600, 0.2);

      gameRef.child('players').transaction(current => {
        if (!current) current = { count: 0 };
        if (current.count >= 2) return;
        current.count++;
        return current;
      }, (error, committed, snapshot) => {
        if (error || !committed) return alert('Room full or error!');
        const data = snapshot.val();
        playerNum = data.count;
        initGame();
      });
    }

    function initGame() {
      gameRef.child('scores').set({1: 0, 2: 0});
      gameRef.child('choices').set(null);
      document.getElementById('status').innerHTML = `You are Player ${playerNum}<br>Waiting for opponent...`;
      document.getElementById('choices').style.display = 'block';
      playSound(800, 0.3);

      gameRef.on('value', snap => updateUI(snap.val() || {}));
    }

    function pick(choice) {
      playSound(400, 0.1);
      gameRef.child('choices').child(playerNum).set(choice);
      document.querySelectorAll('.rps-btn').forEach(b => b.disabled = true);
    }

    function updateUI(game) {
      const myChoice = game.choices?.[playerNum];
      const oppChoice = game.choices?.[3 - playerNum];
      const scores = game.scores || {1:0, 2:0};

      document.getElementById('scores').innerHTML = `
        <div class="score">Player 1: ${scores[1]}</div>
        <div class="score">Player 2: ${scores[2]}</div>
      `;

      if (myChoice && oppChoice) {
        const result = getResult(myChoice, oppChoice);
        document.getElementById('result').innerHTML = `<div class="winner">You: ${emoji(myChoice)} | Opp: ${emoji(oppChoice)}<br>${result}</div>`;
        playSound(result.includes('Win') ? 1000 : 300, 0.5);

        if (result.includes('Win')) {
          confettiBurst();
          scores[playerNum]++;
          if (scores[playerNum] >= winTarget) {
            document.getElementById('victory').style.display = 'block';
            playSound(1200, 1);
          }
        }

        setTimeout(() => {
          gameRef.child('scores').set(scores);
          gameRef.child('choices').set(null);
          document.querySelectorAll('.rps-btn').forEach(b => b.disabled = false);
          document.getElementById('result').innerHTML = '';
        }, 3000);
      } else if (myChoice) {
        document.getElementById('status').textContent = 'Waiting for opponent...';
      }
    }

    function getResult(my, opp) {
      const myVal = choices[my], oppVal = choices[opp];
      if (myVal === oppVal) return 'Tie!';
      return beats[myVal] === oppVal ? 'YOU WIN THIS ROUND! üéâ' : 'You lose this round üò§';
    }

    function emoji(c) { return {rock: 'ü™®', paper: 'üìÑ', scissors: '‚úÇÔ∏è'}[c]; }
  </script>
</body>
</html>